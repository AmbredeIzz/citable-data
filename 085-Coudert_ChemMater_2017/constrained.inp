! -*- cp2k -*-

@SET SYSTEM constrained
@SET PRINT_STEP 10
@SET RESTART_STEP 1000
@SET RESTART 0

&GLOBAL
  PROJECT $SYSTEM
  RUN_TYPE MD
  PRINT_LEVEL MEDIUM
# WALLTIME 83700
&END GLOBAL

&MOTION
  &MD
    STEPS 40000
    ENSEMBLE NVT
    TIMESTEP [fs] 0.5
    TEMPERATURE [K] 298.0

    &THERMOSTAT
      TYPE CSVR
      #REGION MASSIVE
      REGION GLOBAL
      &CSVR
	TIMECON [fs] 100.0
      &END CSVR
    &END THERMOSTAT

  &END MD
  &PRINT
    &TRAJECTORY  SILENT
      FILENAME =${SYSTEM}-1.xyz
      &EACH
        MD $PRINT_STEP
      &END EACH
    &END TRAJECTORY
    &CELL
      FILENAME =${SYSTEM}-1.cell
      &EACH
        MD $PRINT_STEP
      &END EACH
    &END CELL
    &STRESS  SILENT
      FILENAME =${SYSTEM}-1.stress
      &EACH
        MD $PRINT_STEP
      &END EACH
    &END STRESS
    &VELOCITIES  SILENT
      FILENAME =${SYSTEM}-1.vel
      &EACH
        MD $PRINT_STEP
      &END EACH
    &END VELOCITIES
    &FORCES  SILENT
      FILENAME =${SYSTEM}-1.force
      &EACH
        MD $PRINT_STEP
      &END EACH
    &END FORCES
    &RESTART
      FILENAME =${SYSTEM}-1.restart
      &EACH
        MD $RESTART_STEP
      &END EACH
    &END RESTART
  &END PRINT

  &CONSTRAINT

   SHAKE 1.0E-8

     &COLLECTIVE
       COLVAR 1
       INTERMOLECULAR
       TARGET [angstrom] 5.76
     &END COLLECTIVE
     &COLLECTIVE
       COLVAR 2
       INTERMOLECULAR
       TARGET [angstrom] 5.25
     &END COLLECTIVE

    &CONSTRAINT_INFO MEDIUM
       &EACH
         MD      1
       &END
        COMMON_ITERATION_LEVELS 1
     &END CONSTRAINT_INFO

     &LAGRANGE_MULTIPLIERS MEDIUM
       &EACH
         MD      1
       &END
       COMMON_ITERATION_LEVELS 1
     &END LAGRANGE_MULTIPLIERS

  &END CONSTRAINT


&END MOTION

@INCLUDE 'constrained.force_eval.inc'

@IF ${RESTART} == 1
&EXT_RESTART
  EXTERNAL_FILE ${SYSTEM}-1.restart
  RESTART_COUNTERS    T
  RESTART_AVERAGES    T
  RESTART_POS         T
  RESTART_VEL         T
  RESTART_THERMOSTAT  T
  RESTART_BAROSTAT    T
  RESTART_CELL        T
&END EXT_RESTART
@ENDIF
